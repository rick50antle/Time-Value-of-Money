<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial A: The Puzzle | Time Value of Money</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f8fafc; min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useCallback, useEffect, useRef } = React;

const LucideIcon = ({ name, size = 24, color = 'currentColor', style = {} }) => {
    const iconRef = useRef(null);
    useEffect(() => {
        if (iconRef.current && lucide[name]) {
            iconRef.current.innerHTML = '';
            const svg = lucide.createElement(lucide[name]);
            svg.setAttribute('width', size);
            svg.setAttribute('height', size);
            svg.setAttribute('stroke', color);
            iconRef.current.appendChild(svg);
        }
    }, [name, size, color]);
    return <span ref={iconRef} style={{ display: 'inline-flex', alignItems: 'center', ...style }} />;
};


// ============================================================================
// COLORS (Yale Blue Theme)
// ============================================================================

const COLORS = {
  primary: '#00356b',
  primaryLight: '#1a4a7a',
  primaryDark: '#002548',
  background: '#f8fafc',
  surface: '#ffffff',
  surfaceAlt: '#f1f5f9',
  border: '#e2e8f0',
  borderDark: '#cbd5e1',
  textPrimary: '#1e293b',
  textSecondary: '#64748b',
  textMuted: '#94a3b8',
  accent: '#0369a1',
  accentLight: '#e0f2fe',
  gold: '#ca8a04',
  goldLight: '#fef9c3',
  goldBorder: '#eab308',
  success: '#16a34a',
  successBg: '#f0fdf4',
  successBorder: '#86efac',
  warning: '#d97706',
  warningBg: '#fffbeb',
  warningBorder: '#fcd34d',
  rabbitHole: '#7c3aed',
  rabbitHoleLight: '#ede9fe',
  rabbitHoleBorder: '#a78bfa',
};

// ============================================================================
// TUTORIAL STRUCTURE
// ============================================================================

const PARTS = [
  { id: 'welcome', title: 'Welcome', steps: 3 },
  { id: 'whatKindOfMath', title: 'What Kind of Math?', steps: 5 },
  { id: 'thePuzzle', title: 'The Puzzle', steps: 4 },
  { id: 'canWeDefineValue', title: 'Can We Define Value?', steps: 6 },
];

// ============================================================================
// RABBIT HOLES
// ============================================================================

const RABBIT_HOLES = {
  tickerTape: {
    id: 'tickerTape',
    title: 'The Ticker Tape Era',
    content: `In the 1920s, before computers and instant messaging, stock market information traveled through ticker tape machines. These little devices punched holes in paper tape and streamed out tables of trades from the New York Stock Exchange.

Rich investors were so eager for information that brokerage offices existed on cruise liners crossing the Atlantic â€” imagine checking your portfolio on the Titanic!

Standard & Poor's emerged during this era as a company providing data on bonds and corporate securities. The S&P 500 index we use today is a direct descendant of this information revolution â€” 500 stocks chosen to be representative of the U.S. economy, adjusting over time from steel and auto companies to today's tech giants.`
  },
  
  logScales: {
    id: 'logScales',
    title: 'Why Some Charts Look Straight',
    content: `When you see a chart of the S&P 500 over decades, it curves upward dramatically. But sometimes you'll see charts where long-term growth looks like a straight line. That's a logarithmic scale.

On a log scale, equal vertical distances represent equal percentage changes, not equal dollar changes. A move from $100 to $200 (100% gain) takes the same vertical space as a move from $1,000 to $2,000 (also 100% gain).

This makes log scales perfect for visualizing compound growth â€” because compound growth IS multiplicative. The curve becomes a line, and the slope tells you the growth rate directly.

When you see a financial chart, always check the axes. Is it linear or logarithmic? The shape of the line depends entirely on this choice.`
  },
  
  indexInvesting: {
    id: 'indexInvesting',
    title: 'A Personal Aside on Investing',
    content: `"My own personal investing: I have cash and I have S&P 500 index because I'm sort of invested in the country generally, but without taking risks in any particular stock."

This is the professor's actual investment strategy. It reflects decades of financial research showing that most active investors don't beat index funds over the long term â€” and you pay more in fees trying.

The logic: if you believe the U.S. economy will grow over your investment horizon, an index fund lets you capture that growth without betting on individual companies. You won't get rich quick, but you're unlikely to go broke either.

This isn't advice â€” it's just transparency about how someone who has studied finance for 40 years actually invests.`
  },
};

// ============================================================================
// GLOSSARY
// ============================================================================

const GLOSSARY = {
  cashFlowStream: {
    term: 'Cash Flow Stream',
    definition: 'A sequence of money amounts at different points in time. Defined by how much and when.',
  },
  compoundGrowth: {
    term: 'Compound Growth',
    definition: 'Growth where the increase in each period is a percentage of the current amount, not the original amount. Creates a curved, accelerating pattern.',
  },
  linearGrowth: {
    term: 'Linear Growth',
    definition: 'Growth where the increase is the same fixed amount each period. Creates a straight line pattern.',
  },
  period: {
    term: 'Period',
    definition: 'A span of time between two points. Period 1 is the interval between Time 0 and Time 1.',
  },
  value: {
    term: 'Value (Financial)',
    definition: 'A number assigned to a cash flow stream to capture how much it is worth. The challenge: without markets, this number depends on who is measuring.',
  },
};

// ============================================================================
// SOUND SYSTEM
// ============================================================================

const playSound = (type) => {
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);
    
    switch (type) {
      case 'success':
        oscillator.frequency.setValueAtTime(523.25, ctx.currentTime);
        oscillator.frequency.setValueAtTime(659.25, ctx.currentTime + 0.1);
        oscillator.frequency.setValueAtTime(783.99, ctx.currentTime + 0.2);
        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + 0.4);
        break;
      case 'softNope':
        oscillator.frequency.setValueAtTime(783.99, ctx.currentTime);
        oscillator.frequency.setValueAtTime(659.25, ctx.currentTime + 0.15);
        gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + 0.3);
        break;
      case 'click':
        oscillator.frequency.setValueAtTime(600, ctx.currentTime);
        gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.08);
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + 0.08);
        break;
      case 'rabbitHole':
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(880, ctx.currentTime);
        oscillator.frequency.setValueAtTime(932.33, ctx.currentTime + 0.05);
        oscillator.frequency.setValueAtTime(880, ctx.currentTime + 0.1);
        gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.25);
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + 0.25);
        break;
      default:
        break;
    }
    setTimeout(() => ctx.close(), 500);
  } catch (e) {
    // Fail silently
  }
};

// ============================================================================
// UTILITY FUNCTIONS
// ============================================================================

const calculateProgress = (currentPartIndex, currentStep) => {
  const totalSteps = PARTS.reduce((sum, p) => sum + p.steps, 0);
  const completedSteps = PARTS.slice(0, currentPartIndex).reduce((sum, p) => sum + p.steps, 0) + currentStep;
  
  // If we're on the very last step, show 100%
  const isLastStep = currentPartIndex === PARTS.length - 1 && currentStep === PARTS[currentPartIndex].steps - 1;
  if (isLastStep) return 100;
  
  return Math.round((completedSteps / totalSteps) * 100);
};

// ============================================================================
// UI COMPONENTS
// ============================================================================

// --- Header ---
const Header = ({ 
  currentPartIndex, 
  currentStep, 
  exploredRabbitHoles, 
  onGlossaryClick, 
  onRestartClick,
  onHeaderClick,
  soundEnabled,
  onSoundToggle 
}) => {
  const progress = calculateProgress(currentPartIndex, currentStep);
  const currentPart = PARTS[currentPartIndex];
  const totalRabbitHoles = Object.keys(RABBIT_HOLES).length;
  
  return (
    <header style={{
      background: COLORS.primary,
      color: 'white',
      padding: '16px 24px',
      position: 'sticky',
      top: 0,
      zIndex: 100,
    }}>
      <div style={{ maxWidth: '800px', margin: '0 auto' }}>
        <div style={{
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          marginBottom: '12px',
        }}>
          <h1 
            onClick={onHeaderClick}
            style={{
              fontSize: '18px',
              fontWeight: '600',
              margin: 0,
              cursor: 'default',
              userSelect: 'none',
            }}
          >
            The Puzzle
          </h1>
          
          <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
            <button
              onClick={onSoundToggle}
              style={{
                background: 'rgba(255,255,255,0.1)',
                border: 'none',
                borderRadius: '6px',
                padding: '6px',
                cursor: 'pointer',
                color: 'white',
                display: 'flex',
                alignItems: 'center',
              }}
            >
              {soundEnabled ? <LucideIcon name="Volume2" size={18} /> : <LucideIcon name="VolumeX" size={18} />}
            </button>
            
            <div style={{
              display: 'flex',
              alignItems: 'center',
              gap: '4px',
              background: COLORS.rabbitHoleLight,
              color: COLORS.rabbitHole,
              padding: '4px 10px',
              borderRadius: '12px',
              fontSize: '13px',
              fontWeight: '500',
            }}>
              <LucideIcon name="Rabbit" size={14} />
              {exploredRabbitHoles.length}/{totalRabbitHoles}
            </div>
            
            <button
              onClick={onGlossaryClick}
              style={{
                background: 'rgba(255,255,255,0.1)',
                border: 'none',
                borderRadius: '6px',
                padding: '6px 10px',
                cursor: 'pointer',
                color: 'white',
                display: 'flex',
                alignItems: 'center',
                gap: '4px',
                fontSize: '13px',
              }}
            >
              <LucideIcon name="BookOpen" size={16} />
              Glossary
            </button>
            
            <button
              onClick={onRestartClick}
              style={{
                background: 'rgba(255,255,255,0.1)',
                border: 'none',
                borderRadius: '6px',
                padding: '6px',
                cursor: 'pointer',
                color: 'white',
                display: 'flex',
                alignItems: 'center',
              }}
            >
              <LucideIcon name="RotateCcw" size={18} />
            </button>
          </div>
        </div>
        
        <div>
          <div style={{
            display: 'flex',
            justifyContent: 'space-between',
            fontSize: '13px',
            marginBottom: '6px',
            opacity: 0.9,
          }}>
            <span>Part {currentPartIndex + 1}: {currentPart.title}</span>
            <span>{progress}% complete</span>
          </div>
          
          <div style={{
            background: 'rgba(255,255,255,0.2)',
            borderRadius: '4px',
            height: '6px',
            overflow: 'hidden',
          }}>
            <div style={{
              background: COLORS.goldBorder,
              height: '100%',
              width: `${progress}%`,
              transition: 'width 0.3s ease',
              borderRadius: '4px',
            }} />
          </div>
        </div>
      </div>
    </header>
  );
};

// --- Navigation Buttons ---
const NavButtons = ({ onBack, onContinue, canGoBack, canContinue, continueLabel = 'Continue', soundEnabled }) => {
  const handleContinue = () => {
    if (soundEnabled) playSound('click');
    onContinue();
  };
  
  const handleBack = () => {
    if (soundEnabled) playSound('click');
    onBack();
  };
  
  return (
    <div style={{
      display: 'flex',
      justifyContent: 'space-between',
      marginTop: '32px',
      paddingTop: '24px',
      borderTop: `1px solid ${COLORS.border}`,
    }}>
      <button
        onClick={handleBack}
        disabled={!canGoBack}
        style={{
          display: 'flex',
          alignItems: 'center',
          gap: '6px',
          padding: '10px 20px',
          border: `1px solid ${COLORS.border}`,
          borderRadius: '8px',
          background: 'white',
          color: canGoBack ? COLORS.textPrimary : COLORS.textMuted,
          cursor: canGoBack ? 'pointer' : 'not-allowed',
          fontSize: '15px',
          opacity: canGoBack ? 1 : 0.5,
        }}
      >
        <LucideIcon name="ChevronLeft" size={18} />
        Back
      </button>
      
      <button
        onClick={handleContinue}
        disabled={!canContinue}
        style={{
          display: 'flex',
          alignItems: 'center',
          gap: '6px',
          padding: '10px 24px',
          border: 'none',
          borderRadius: '8px',
          background: canContinue ? COLORS.primary : COLORS.textMuted,
          color: 'white',
          cursor: canContinue ? 'pointer' : 'not-allowed',
          fontSize: '15px',
          fontWeight: '500',
        }}
      >
        {continueLabel}
        <LucideIcon name="ChevronRight" size={18} />
      </button>
    </div>
  );
};

// --- Choice Button ---
const ChoiceButton = ({ label, selected, correct, submitted, onClick, disabled }) => {
  let background = 'white';
  let borderColor = COLORS.border;
  let textColor = COLORS.textPrimary;
  
  if (selected && !submitted) {
    background = COLORS.accentLight;
    borderColor = COLORS.accent;
  } else if (submitted) {
    if (correct) {
      background = COLORS.successBg;
      borderColor = COLORS.successBorder;
    } else if (selected && !correct) {
      background = COLORS.warningBg;
      borderColor = COLORS.warningBorder;
    } else {
      textColor = COLORS.textMuted;
    }
  }
  
  return (
    <button
      onClick={onClick}
      disabled={disabled || submitted}
      style={{
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
        width: '100%',
        padding: '14px 16px',
        border: `2px solid ${borderColor}`,
        borderRadius: '10px',
        background,
        color: textColor,
        cursor: disabled || submitted ? 'default' : 'pointer',
        fontSize: '15px',
        textAlign: 'left',
        transition: 'all 0.2s ease',
      }}
    >
      {submitted && correct && <LucideIcon name="Check" size={20} color={COLORS.success} />}
      {submitted && selected && !correct && <LucideIcon name="X" size={20} color={COLORS.warning} />}
      {!submitted && <div style={{
        width: '20px',
        height: '20px',
        borderRadius: '50%',
        border: `2px solid ${selected ? COLORS.accent : COLORS.border}`,
        background: selected ? COLORS.accent : 'white',
      }} />}
      <span>{label}</span>
    </button>
  );
};

// --- Insight Box ---
const InsightBox = ({ children, icon }) => (
  <div style={{
    background: COLORS.goldLight,
    border: `2px solid ${COLORS.goldBorder}`,
    borderRadius: '12px',
    padding: '20px',
    marginTop: '20px',
    marginBottom: '20px',
  }}>
    <div style={{ display: 'flex', gap: '12px', alignItems: 'flex-start' }}>
      {icon || <LucideIcon name="Lightbulb" size={24} color={COLORS.gold} style={{ flexShrink: 0, marginTop: '2px' }} />}
      <div style={{ fontSize: '16px', lineHeight: '1.6', color: COLORS.textPrimary }}>
        {children}
      </div>
    </div>
  </div>
);

// --- Cash Flow Diagram ---
const CashFlowDiagram = ({ flows, highlightPeriod, label }) => {
  const maxPeriod = Math.max(...flows.map(f => f.period));
  
  return (
    <div style={{
      background: COLORS.surfaceAlt,
      borderRadius: '12px',
      padding: '24px',
      marginTop: '16px',
      marginBottom: '16px',
    }}>
      {label && (
        <div style={{
          fontSize: '14px',
          fontWeight: '600',
          color: COLORS.textSecondary,
          marginBottom: '16px',
          textAlign: 'center',
        }}>
          {label}
        </div>
      )}
      
      <div style={{
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'flex-end',
        position: 'relative',
        minHeight: '100px',
        paddingBottom: '40px',
      }}>
        <div style={{
          position: 'absolute',
          bottom: '20px',
          left: '0',
          right: '0',
          height: '2px',
          background: COLORS.borderDark,
        }} />
        
        {Array.from({ length: maxPeriod + 1 }, (_, i) => {
          const flow = flows.find(f => f.period === i);
          const isHighlighted = highlightPeriod === i;
          
          return (
            <div key={i} style={{
              display: 'flex',
              flexDirection: 'column',
              alignItems: 'center',
              position: 'relative',
              flex: 1,
            }}>
              {flow && (
                <div style={{
                  background: isHighlighted ? COLORS.primary : 'white',
                  color: isHighlighted ? 'white' : COLORS.textPrimary,
                  border: `2px solid ${isHighlighted ? COLORS.primary : COLORS.border}`,
                  borderRadius: '8px',
                  padding: '8px 12px',
                  marginBottom: '12px',
                  fontFamily: 'monospace',
                  fontSize: '15px',
                  fontWeight: '600',
                }}>
                  ${flow.amount.toFixed(2)}
                </div>
              )}
              
              {flow && (
                <div style={{
                  width: '2px',
                  height: '20px',
                  background: isHighlighted ? COLORS.primary : COLORS.borderDark,
                }} />
              )}
              
              <div style={{
                width: '12px',
                height: '12px',
                borderRadius: '50%',
                background: flow ? (isHighlighted ? COLORS.primary : COLORS.textSecondary) : COLORS.border,
                position: 'absolute',
                bottom: '14px',
              }} />
              
              <span style={{
                position: 'absolute',
                bottom: '-8px',
                fontSize: '13px',
                color: COLORS.textSecondary,
              }}>
                Time {i}
              </span>
            </div>
          );
        })}
      </div>
    </div>
  );
};

// --- Rabbit Hole Button ---
const RabbitHoleButton = ({ rabbitHole, explored, onClick, soundEnabled }) => {
  const handleClick = () => {
    if (soundEnabled) playSound('rabbitHole');
    onClick();
  };
  
  return (
    <button
      onClick={handleClick}
      style={{
        display: 'flex',
        alignItems: 'center',
        gap: '10px',
        width: '100%',
        padding: '14px 16px',
        border: `2px dashed ${COLORS.rabbitHoleBorder}`,
        borderRadius: '10px',
        background: explored ? COLORS.rabbitHoleLight : 'white',
        color: COLORS.rabbitHole,
        cursor: 'pointer',
        fontSize: '14px',
        textAlign: 'left',
        marginTop: '16px',
        transition: 'all 0.2s ease',
      }}
    >
      <LucideIcon name="Rabbit" size={20} style={{ flexShrink: 0 }} />
      <span style={{ flex: 1 }}>{rabbitHole.title}</span>
      {explored && <LucideIcon name="Check" size={18} />}
    </button>
  );
};

// --- Rabbit Hole Modal ---
const RabbitHoleModal = ({ rabbitHole, onClose }) => {
  if (!rabbitHole) return null;
  
  return (
    <div style={{
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.5)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '20px',
      zIndex: 1000,
    }}>
      <div style={{
        background: 'white',
        borderRadius: '16px',
        maxWidth: '600px',
        maxHeight: '80vh',
        overflow: 'auto',
        boxShadow: '0 20px 60px rgba(0,0,0,0.3)',
      }}>
        <div style={{
          background: COLORS.rabbitHole,
          color: 'white',
          padding: '20px 24px',
          display: 'flex',
          alignItems: 'center',
          gap: '12px',
        }}>
          <LucideIcon name="Rabbit" size={24} />
          <h2 style={{ margin: 0, fontSize: '20px', fontWeight: '600' }}>
            {rabbitHole.title}
          </h2>
        </div>
        
        <div style={{
          padding: '24px',
          fontSize: '15px',
          lineHeight: '1.7',
          color: COLORS.textPrimary,
        }}>
          {rabbitHole.content.split('\n\n').map((paragraph, i) => (
            <p key={i} style={{ margin: i === 0 ? 0 : '16px 0 0 0' }}>
              {paragraph}
            </p>
          ))}
        </div>
        
        <div style={{
          padding: '16px 24px',
          borderTop: `1px solid ${COLORS.border}`,
          display: 'flex',
          justifyContent: 'flex-end',
        }}>
          <button
            onClick={onClose}
            style={{
              padding: '10px 24px',
              border: 'none',
              borderRadius: '8px',
              background: COLORS.rabbitHole,
              color: 'white',
              fontSize: '15px',
              fontWeight: '500',
              cursor: 'pointer',
            }}
          >
            Back to Tutorial
          </button>
        </div>
      </div>
    </div>
  );
};

// --- Glossary Modal ---
const GlossaryModal = ({ onClose }) => (
  <div style={{
    position: 'fixed',
    inset: 0,
    background: 'rgba(0,0,0,0.5)',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    padding: '20px',
    zIndex: 1000,
  }}>
    <div style={{
      background: 'white',
      borderRadius: '16px',
      maxWidth: '600px',
      maxHeight: '80vh',
      overflow: 'auto',
      boxShadow: '0 20px 60px rgba(0,0,0,0.3)',
    }}>
      <div style={{
        background: COLORS.primary,
        color: 'white',
        padding: '20px 24px',
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
      }}>
        <LucideIcon name="BookOpen" size={24} />
        <h2 style={{ margin: 0, fontSize: '20px', fontWeight: '600' }}>Glossary</h2>
      </div>
      
      <div style={{ padding: '16px 24px' }}>
        {Object.values(GLOSSARY).map((item, i) => (
          <div key={item.term} style={{
            padding: '16px 0',
            borderBottom: i < Object.values(GLOSSARY).length - 1 ? `1px solid ${COLORS.border}` : 'none',
          }}>
            <h3 style={{
              margin: '0 0 6px 0',
              fontSize: '16px',
              fontWeight: '600',
              color: COLORS.primary,
            }}>
              {item.term}
            </h3>
            <p style={{
              margin: 0,
              fontSize: '14px',
              lineHeight: '1.5',
              color: COLORS.textSecondary,
            }}>
              {item.definition}
            </p>
          </div>
        ))}
      </div>
      
      <div style={{
        padding: '16px 24px',
        borderTop: `1px solid ${COLORS.border}`,
        display: 'flex',
        justifyContent: 'flex-end',
      }}>
        <button
          onClick={onClose}
          style={{
            padding: '10px 24px',
            border: 'none',
            borderRadius: '8px',
            background: COLORS.primary,
            color: 'white',
            fontSize: '15px',
            fontWeight: '500',
            cursor: 'pointer',
          }}
        >
          Close
        </button>
      </div>
    </div>
  </div>
);

// --- Dev Mode Panel ---
const DevModePanel = ({ onJumpToPart, currentPartIndex, onClose }) => (
  <div style={{
    position: 'fixed',
    bottom: '20px',
    right: '20px',
    background: 'white',
    border: `2px solid ${COLORS.warning}`,
    borderRadius: '12px',
    padding: '16px',
    boxShadow: '0 10px 40px rgba(0,0,0,0.15)',
    zIndex: 999,
  }}>
    <div style={{
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '12px',
    }}>
      <h3 style={{ margin: 0, fontSize: '14px', color: COLORS.warning, fontWeight: '600' }}>
        ðŸ›  Dev Mode
      </h3>
      <button onClick={onClose} style={{ background: 'none', border: 'none', cursor: 'pointer', color: COLORS.textMuted }}>
        <LucideIcon name="X" size={18} />
      </button>
    </div>
    
    <div style={{ display: 'flex', flexDirection: 'column', gap: '6px' }}>
      {PARTS.map((part, index) => (
        <button
          key={part.id}
          onClick={() => onJumpToPart(index)}
          style={{
            padding: '8px 12px',
            border: `1px solid ${index === currentPartIndex ? COLORS.warning : COLORS.border}`,
            borderRadius: '6px',
            background: index === currentPartIndex ? COLORS.warningBg : 'white',
            color: COLORS.textPrimary,
            fontSize: '13px',
            textAlign: 'left',
            cursor: 'pointer',
          }}
        >
          {index + 1}. {part.title}
        </button>
      ))}
    </div>
  </div>
);

// ============================================================================
// CONTENT COMPONENTS
// ============================================================================

// --- Part 1: Welcome ---
const WelcomePart = ({ step, onStepComplete }) => {
  const content = [
    // Step 0: Hook
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>Which would you prefer?</h2>
      <div style={{ display: 'flex', gap: '16px', marginBottom: '24px', flexWrap: 'wrap' }}>
        <div style={{
          flex: 1,
          minWidth: '200px',
          padding: '20px',
          background: COLORS.surfaceAlt,
          borderRadius: '12px',
          textAlign: 'center',
        }}>
          <div style={{ fontSize: '32px', fontWeight: '700', color: COLORS.primary, fontFamily: 'monospace' }}>
            $83.96
          </div>
          <div style={{ fontSize: '14px', color: COLORS.textSecondary, marginTop: '8px' }}>
            today
          </div>
        </div>
        <div style={{
          flex: 1,
          minWidth: '200px',
          padding: '20px',
          background: COLORS.surfaceAlt,
          borderRadius: '12px',
          textAlign: 'center',
        }}>
          <div style={{ fontSize: '32px', fontWeight: '700', color: COLORS.primary, fontFamily: 'monospace' }}>
            $100.00
          </div>
          <div style={{ fontSize: '14px', color: COLORS.textSecondary, marginTop: '8px' }}>
            three years from now
          </div>
        </div>
      </div>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        This seems like a simple question. But as we'll discover, it's actually impossible to answer â€” at least, not without adding something to the picture.
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        By the end of this tutorial, you'll understand why.
      </p>
    </>,
    
    // Step 1: What we'll cover
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>What we'll explore</h2>
      <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
        {[
          { icon: <LucideIcon name="TrendingUp" size={20} />, text: 'Why financial growth is curved, not straight' },
          { icon: <LucideIcon name="HelpCircle" size={20} />, text: 'A puzzle that seems impossible to solve' },
          { icon: <LucideIcon name="Lightbulb" size={20} />, text: 'Why "value" is harder to define than you might think' },
        ].map((item, i) => (
          <div key={i} style={{
            display: 'flex',
            alignItems: 'center',
            gap: '12px',
            padding: '12px 16px',
            background: COLORS.surfaceAlt,
            borderRadius: '8px',
          }}>
            <div style={{ color: COLORS.primary }}>{item.icon}</div>
            <span style={{ color: COLORS.textPrimary }}>{item.text}</span>
          </div>
        ))}
      </div>
      <div style={{
        marginTop: '24px',
        padding: '12px 16px',
        background: COLORS.accentLight,
        borderRadius: '8px',
        display: 'flex',
        alignItems: 'center',
        gap: '10px',
      }}>
        <LucideIcon name="Clock" size={18} color={COLORS.accent} />
        <span style={{ fontSize: '14px', color: COLORS.accent }}>
          About 15 minutes Â· Optional explorations available
        </span>
      </div>
    </>,
    
    // Step 2: A note on assumptions
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>A note before we begin</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        Throughout this tutorial (and this course), we'll make simplifying assumptions. We'll ignore taxes, transaction costs, and many real-world complications.
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        This isn't because those things don't matter â€” they do. It's because we need to see the core logic clearly first. Once you understand how things work without friction, you can add realistic complications back in.
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        Think of it like physics assuming "no air resistance." Useful for understanding, dangerous if you forget it's an assumption.
      </p>
      <div style={{
        marginTop: '20px',
        padding: '16px',
        background: COLORS.surfaceAlt,
        borderRadius: '8px',
        borderLeft: `4px solid ${COLORS.gold}`,
      }}>
        <p style={{ margin: 0, color: COLORS.textPrimary, fontSize: '14px' }}>
          <strong>We're talking about financial value only.</strong> Not what you value personally â€” kindness, family, meaning. Just money. That's obviously not everything, but it's what we can measure.
        </p>
      </div>
    </>,
  ];
  
  return content[step] || null;
};

// --- Part 2: What Kind of Math? ---
const WhatKindOfMathPart = ({ step, onAnswer, answers, soundEnabled, onRabbitHole, exploredRabbitHoles }) => {
  const content = [
    // Step 0: S&P 500 intro
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>The S&P 500</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        Let's start by looking at something real: the S&P 500 index. It tracks 500 large U.S. companies, chosen to be representative of the economy.
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        Here's how it's grown over the past century â€” from about 320 in the 1920s to over 6,000 today.
      </p>
      <div style={{
        marginTop: '20px',
        padding: '24px',
        background: COLORS.surfaceAlt,
        borderRadius: '12px',
      }}>
        <div style={{ display: 'flex', alignItems: 'stretch' }}>
          {/* Y-axis labels */}
          <div style={{
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'space-between',
            paddingRight: '8px',
            fontSize: '11px',
            color: COLORS.textMuted,
            height: '120px',
          }}>
            <span>$10,000</span>
            <span>$100</span>
            <span>$1</span>
          </div>
          {/* Chart area */}
          <div style={{ flex: 1 }}>
            <div style={{
              height: '120px',
              display: 'flex',
              alignItems: 'flex-end',
              justifyContent: 'space-between',
              paddingBottom: '8px',
              borderBottom: `2px solid ${COLORS.borderDark}`,
              borderLeft: `2px solid ${COLORS.borderDark}`,
              paddingLeft: '8px',
            }}>
              {/* Simplified S&P chart visualization */}
              {/* Data shows growth with one visible drop (index 4 drops from 12 to 5) */}
              {[5, 6, 8, 12, 5, 18, 25, 35, 50, 70, 100].map((h, i) => (
                <div key={i} style={{
                  width: '8%',
                  height: `${h}%`,
                  background: i === 4 ? COLORS.warning : COLORS.primary,
                  borderRadius: '2px 2px 0 0',
                }} />
              ))}
            </div>
            {/* X-axis labels */}
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              marginTop: '8px',
              fontSize: '12px',
              color: COLORS.textMuted,
              paddingLeft: '8px',
            }}>
              <span>1920s</span>
              <span>Time â†’</span>
              <span>Today</span>
            </div>
          </div>
        </div>
        {/* Y-axis label */}
        <p style={{ color: COLORS.textMuted, fontSize: '11px', marginTop: '8px', textAlign: 'center' }}>
          Value of $1 invested (log scale, simplified)
        </p>
      </div>
      <RabbitHoleButton
        rabbitHole={RABBIT_HOLES.tickerTape}
        explored={exploredRabbitHoles.includes('tickerTape')}
        onClick={() => onRabbitHole('tickerTape')}
        soundEnabled={soundEnabled}
      />
    </>,
    
    // Step 1: What do you notice?
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>What do you notice?</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginBottom: '20px' }}>
        Look at the shape of that growth. What stands out?
      </p>
      <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
        <ChoiceButton
          label="It trends upward over time"
          selected={answers.shape === 'upward'}
          correct={true}
          submitted={answers.shapeSubmitted}
          onClick={() => onAnswer('shape', 'upward')}
        />
        <ChoiceButton
          label="It's curved â€” growth accelerates"
          selected={answers.shape === 'curved'}
          correct={true}
          submitted={answers.shapeSubmitted}
          onClick={() => onAnswer('shape', 'curved')}
        />
        <ChoiceButton
          label="There are big drops sometimes (like 1929)"
          selected={answers.shape === 'drops'}
          correct={true}
          submitted={answers.shapeSubmitted}
          onClick={() => onAnswer('shape', 'drops')}
        />
      </div>
      {answers.shape && !answers.shapeSubmitted && (
        <button
          onClick={() => {
            if (soundEnabled) playSound('success');
            onAnswer('shapeSubmitted', true);
          }}
          style={{
            marginTop: '16px',
            padding: '10px 20px',
            background: COLORS.primary,
            color: 'white',
            border: 'none',
            borderRadius: '8px',
            cursor: 'pointer',
            fontSize: '15px',
          }}
        >
          Submit
        </button>
      )}
      {answers.shapeSubmitted && (
        <div style={{
          marginTop: '16px',
          padding: '16px',
          background: COLORS.successBg,
          borderRadius: '8px',
          color: COLORS.textPrimary,
        }}>
          <strong>All of these are right!</strong> The trend is upward, the growth accelerates (it's curved, not straight), and there are sometimes dramatic drops. Let's focus on that curve.
        </div>
      )}
    </>,
    
    // Step 2: Straight vs curved
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>Straight lines vs. curves</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        If all you knew was "it goes up," you might draw a straight line. But that's not what we see.
      </p>
      <div style={{
        display: 'flex',
        gap: '20px',
        marginTop: '20px',
        flexWrap: 'wrap',
      }}>
        <div style={{
          flex: 1,
          minWidth: '200px',
          padding: '20px',
          background: COLORS.surfaceAlt,
          borderRadius: '12px',
        }}>
          <div style={{ fontSize: '14px', fontWeight: '600', color: COLORS.textSecondary, marginBottom: '12px' }}>
            Linear growth
          </div>
          <div style={{ height: '80px', display: 'flex', alignItems: 'flex-end' }}>
            <div style={{
              width: '100%',
              height: '2px',
              background: COLORS.textMuted,
              transform: 'rotate(-20deg)',
              transformOrigin: 'bottom left',
            }} />
          </div>
          <div style={{ fontSize: '13px', color: COLORS.textMuted, marginTop: '12px' }}>
            Same amount added each period
          </div>
        </div>
        <div style={{
          flex: 1,
          minWidth: '200px',
          padding: '20px',
          background: COLORS.accentLight,
          borderRadius: '12px',
          border: `2px solid ${COLORS.accent}`,
        }}>
          <div style={{ fontSize: '14px', fontWeight: '600', color: COLORS.accent, marginBottom: '12px' }}>
            Compound growth âœ“
          </div>
          <div style={{ height: '80px', position: 'relative' }}>
            <svg width="100%" height="100%" viewBox="0 0 100 80">
              <path
                d="M 0 70 Q 50 65 70 40 T 100 5"
                fill="none"
                stroke={COLORS.primary}
                strokeWidth="2"
              />
            </svg>
          </div>
          <div style={{ fontSize: '13px', color: COLORS.accent, marginTop: '12px' }}>
            Growth is a percentage of current value
          </div>
        </div>
      </div>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '20px' }}>
        With linear growth, you add the same amount each period. With compound growth, you add a <em>percentage</em> of wherever you currently are â€” so as the amount grows, the growth itself gets bigger.
      </p>
    </>,
    
    // Step 3: The math is weird
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>Don't underestimate the weirdness</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        Remember when you first learned about parabolas in algebra? Moving from straight lines (y = mx + b) to curves (y = xÂ²) was probably a significant jump.
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        Compound growth is similar territory. The math isn't complicated â€” it's just multiplication â€” but thinking in multiplicative terms doesn't come naturally.
      </p>
      <InsightBox>
        If you find this weird, you're in good company. Even experts get caught by compound growth. It's been called "the most powerful force in the universe" (though Einstein probably never actually said that).
        <br /><br />
        Give yourself permission to find this strange. Then work through it anyway.
      </InsightBox>
      <RabbitHoleButton
        rabbitHole={RABBIT_HOLES.logScales}
        explored={exploredRabbitHoles.includes('logScales')}
        onClick={() => onRabbitHole('logScales')}
        soundEnabled={soundEnabled}
      />
    </>,
    
    // Step 4: Personal aside
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>Why this matters</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        The S&P 500's growth is a <strong>compounding</strong> process. Understanding compound growth isn't just academic â€” it's how your retirement savings work, how loans accumulate, how economies grow.
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        We're going to work through the mechanics of this step by step. But first, let's see why it creates a problem.
      </p>
      <RabbitHoleButton
        rabbitHole={RABBIT_HOLES.indexInvesting}
        explored={exploredRabbitHoles.includes('indexInvesting')}
        onClick={() => onRabbitHole('indexInvesting')}
        soundEnabled={soundEnabled}
      />
    </>,
  ];
  
  return content[step] || null;
};

// --- Part 3: The Puzzle ---
const ThePuzzlePart = ({ step, onAnswer, answers, soundEnabled }) => {
  const content = [
    // Step 0: Present the two streams
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>Two cash flow streams</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginBottom: '20px' }}>
        Here are two options. Let's call them Stream A and Stream B.
      </p>
      
      <CashFlowDiagram
        flows={[{ period: 0, amount: 83.96 }]}
        highlightPeriod={0}
        label="Stream A"
      />
      
      <CashFlowDiagram
        flows={[{ period: 0, amount: 0 }, { period: 1, amount: 0 }, { period: 2, amount: 0 }, { period: 3, amount: 100 }]}
        highlightPeriod={3}
        label="Stream B"
      />
      
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '16px' }}>
        Stream A gives you $83.96 right now (Time 0).
        <br />
        Stream B gives you $100.00 at Time 3 (three periods from now).
      </p>
    </>,
    
    // Step 1: The rules
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>The rules</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        Here's the catch: whatever you choose, you have to take the money and <strong>within 30 minutes</strong>, spend it all on your favorite food or drink â€” and consume it right there.
      </p>
      <div style={{
        display: 'flex',
        gap: '16px',
        marginTop: '20px',
        flexWrap: 'wrap',
      }}>
        <div style={{
          flex: 1,
          minWidth: '150px',
          padding: '16px',
          background: COLORS.surfaceAlt,
          borderRadius: '10px',
          textAlign: 'center',
        }}>
          <LucideIcon name="Coffee" size={32} color={COLORS.primary} style={{ marginBottom: '8px' }} />
          <div style={{ fontSize: '14px', color: COLORS.textSecondary }}>Coffee?</div>
        </div>
        <div style={{
          flex: 1,
          minWidth: '150px',
          padding: '16px',
          background: COLORS.surfaceAlt,
          borderRadius: '10px',
          textAlign: 'center',
        }}>
          <LucideIcon name="Apple" size={32} color={COLORS.primary} style={{ marginBottom: '8px' }} />
          <div style={{ fontSize: '14px', color: COLORS.textSecondary }}>Snacks?</div>
        </div>
      </div>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '20px' }}>
        No investing. No saving. Just: take the money, spend it on consumption, right away.
      </p>
      <p style={{ color: COLORS.textMuted, fontSize: '14px', marginTop: '12px' }}>
        (This constraint will matter. We're removing other options on purpose.)
      </p>
    </>,
    
    // Step 2: Which do you prefer?
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>Which do you prefer?</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginBottom: '20px' }}>
        Think about it. $83.96 today, or $100 three years from now â€” all spent immediately on food.
      </p>
      <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
        <ChoiceButton
          label="Stream A: $83.96 today"
          selected={answers.preference === 'A'}
          submitted={false}
          onClick={() => onAnswer('preference', 'A')}
        />
        <ChoiceButton
          label="Stream B: $100 in three years"
          selected={answers.preference === 'B'}
          submitted={false}
          onClick={() => onAnswer('preference', 'B')}
        />
      </div>
      {answers.preference && (
        <div style={{
          marginTop: '20px',
          padding: '16px',
          background: COLORS.surfaceAlt,
          borderRadius: '8px',
        }}>
          <p style={{ margin: 0, color: COLORS.textPrimary }}>
            You chose <strong>Stream {answers.preference}</strong>. Good. Hold that thought.
          </p>
        </div>
      )}
    </>,
    
    // Step 3: But wait...
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>But wait...</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        Now imagine two different people making this choice.
      </p>
      <div style={{
        display: 'flex',
        gap: '20px',
        marginTop: '20px',
        flexWrap: 'wrap',
      }}>
        <div style={{
          flex: 1,
          minWidth: '220px',
          padding: '20px',
          background: COLORS.warningBg,
          border: `2px solid ${COLORS.warningBorder}`,
          borderRadius: '12px',
        }}>
          <div style={{ fontSize: '24px', marginBottom: '8px' }}>ðŸ˜«</div>
          <div style={{ fontWeight: '600', color: COLORS.textPrimary, marginBottom: '8px' }}>
            The Hungry Person
          </div>
          <p style={{ margin: 0, fontSize: '14px', color: COLORS.textSecondary }}>
            Hasn't eaten all day. Stomach growling. If they have to eat in 30 minutes, they want the money <strong>now</strong>.
          </p>
        </div>
        <div style={{
          flex: 1,
          minWidth: '220px',
          padding: '20px',
          background: COLORS.successBg,
          border: `2px solid ${COLORS.successBorder}`,
          borderRadius: '12px',
        }}>
          <div style={{ fontSize: '24px', marginBottom: '8px' }}>ðŸ˜Œ</div>
          <div style={{ fontWeight: '600', color: COLORS.textPrimary, marginBottom: '8px' }}>
            The Full Person
          </div>
          <p style={{ margin: 0, fontSize: '14px', color: COLORS.textSecondary }}>
            Just finished a huge meal. Not hungry at all. If they have to eat in 30 minutes... maybe they'd rather <strong>wait</strong> and get more later.
          </p>
        </div>
      </div>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '24px' }}>
        The hungry person prefers Stream A (money now).
        <br />
        The full person might prefer Stream B (more money later).
      </p>
      <p style={{ color: COLORS.primary, lineHeight: '1.6', marginTop: '16px', fontWeight: '500' }}>
        Who's right?
      </p>
    </>,
  ];
  
  return content[step] || null;
};

// --- Part 4: Can We Define Value? ---
const CanWeDefineValuePart = ({ step, onAnswer, answers, soundEnabled }) => {
  const content = [
    // Step 0: Both are right
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>Who's right?</h2>
      <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', marginBottom: '20px' }}>
        <ChoiceButton
          label="The hungry person"
          selected={answers.whoRight === 'hungry'}
          correct={answers.whoRightSubmitted ? true : undefined}
          submitted={answers.whoRightSubmitted}
          onClick={() => onAnswer('whoRight', 'hungry')}
        />
        <ChoiceButton
          label="The full person"
          selected={answers.whoRight === 'full'}
          correct={answers.whoRightSubmitted ? true : undefined}
          submitted={answers.whoRightSubmitted}
          onClick={() => onAnswer('whoRight', 'full')}
        />
        <ChoiceButton
          label="Both are right"
          selected={answers.whoRight === 'both'}
          correct={answers.whoRightSubmitted ? true : undefined}
          submitted={answers.whoRightSubmitted}
          onClick={() => onAnswer('whoRight', 'both')}
        />
      </div>
      {answers.whoRight && !answers.whoRightSubmitted && (
        <button
          onClick={() => {
            if (soundEnabled) playSound('success');
            onAnswer('whoRightSubmitted', true);
          }}
          style={{
            padding: '10px 20px',
            background: COLORS.primary,
            color: 'white',
            border: 'none',
            borderRadius: '8px',
            cursor: 'pointer',
            fontSize: '15px',
          }}
        >
          Submit
        </button>
      )}
      {answers.whoRightSubmitted && (
        <InsightBox>
          <strong>All answers are correct!</strong> That's the point. The hungry person is right to prefer money now. The full person is right to prefer money later. They just have different preferences.
        </InsightBox>
      )}
    </>,
    
    // Step 1: The measurement problem
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>The measurement problem</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        To <em>measure</em> something means to assign numbers to it in a way that captures some property we care about.
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        Think about measuring <strong>length</strong>. My ruler and your ruler give the same answer. The measurement doesn't depend on who's measuring. The stick has a length; we measure it; done.
      </p>
      <div style={{
        marginTop: '20px',
        padding: '16px 20px',
        background: COLORS.surfaceAlt,
        borderRadius: '10px',
        display: 'flex',
        alignItems: 'center',
        gap: '16px',
      }}>
        <div style={{ fontSize: '32px' }}>ðŸ“</div>
        <div>
          <div style={{ fontWeight: '600', color: COLORS.textPrimary }}>Length is measurable</div>
          <div style={{ fontSize: '14px', color: COLORS.textSecondary }}>Everyone's ruler gives the same answer</div>
        </div>
      </div>
    </>,
    
    // Step 2: Value doesn't work this way
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>Value doesn't work this way</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        Now try to "measure" the value of Stream A versus Stream B.
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        If I ask "what number captures the value of Stream A?" â€” there's no single answer. The number depends on <em>who's doing the measuring</em>.
      </p>
      <div style={{
        display: 'flex',
        gap: '16px',
        marginTop: '20px',
        flexWrap: 'wrap',
      }}>
        <div style={{
          flex: 1,
          minWidth: '200px',
          padding: '16px',
          background: COLORS.warningBg,
          borderRadius: '10px',
        }}>
          <div style={{ fontWeight: '600', color: COLORS.textPrimary, marginBottom: '4px' }}>Hungry person's ruler</div>
          <div style={{ fontSize: '14px', color: COLORS.textSecondary }}>Stream A &gt; Stream B</div>
        </div>
        <div style={{
          flex: 1,
          minWidth: '200px',
          padding: '16px',
          background: COLORS.successBg,
          borderRadius: '10px',
        }}>
          <div style={{ fontWeight: '600', color: COLORS.textPrimary, marginBottom: '4px' }}>Full person's ruler</div>
          <div style={{ fontSize: '14px', color: COLORS.textSecondary }}>Stream B &gt; Stream A</div>
        </div>
      </div>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '20px' }}>
        Unlike length, where two people measuring the same stick get the same answer, two people "measuring" the value of the same cash flow stream get <strong>different answers</strong>.
      </p>
    </>,
    
    // Step 3: No function exists
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>No single function can work</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        If we wanted to create a "value function" â€” some formula V that assigns a number to any cash flow stream â€” we'd need it to satisfy everyone's preferences.
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        But to capture the hungry person's preferences: V(A) &gt; V(B)
        <br />
        And to capture the full person's preferences: V(B) &gt; V(A)
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        No single function can do both. We'd need a different value function for each person.
      </p>
      <div style={{
        marginTop: '20px',
        padding: '16px 20px',
        background: COLORS.warningBg,
        borderRadius: '10px',
        borderLeft: `4px solid ${COLORS.warning}`,
      }}>
        <p style={{ margin: 0, color: COLORS.textPrimary }}>
          <strong>This means value â€” as we normally think about it â€” can't be measured.</strong> There's no single number that captures "the value" of a cash flow stream, because the number depends on who's doing the measuring.
        </p>
      </div>
    </>,
    
    // Step 4: We're stuck
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>We're stuck</h2>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6' }}>
        So where does that leave us? If we want to have sensible conversations about financial value, we can't just rely on individual preferences. People disagree, and there's no way to say who's "right."
      </p>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '12px' }}>
        We need something more. We need to change the setting.
      </p>
      <div style={{
        marginTop: '24px',
        padding: '20px',
        background: COLORS.surfaceAlt,
        borderRadius: '12px',
        textAlign: 'center',
      }}>
        <LucideIcon name="HelpCircle" size={40} color={COLORS.textMuted} style={{ marginBottom: '12px' }} />
        <p style={{ margin: 0, color: COLORS.textSecondary }}>
          What could we add to this picture that would let us define value in a way that doesn't depend on individual preferences?
        </p>
      </div>
    </>,
    
    // Step 5: The insight
    <>
      <h2 style={{ color: COLORS.primary, marginBottom: '16px' }}>The key insight</h2>
      <InsightBox>
        Without markets, value depends on who's measuring. The hungry person and the full person are both right â€” they just want different things. There's no single number that captures "the value" of a cash flow stream.
        <br /><br />
        To measure value, we need something that makes the measurement <strong>not depend on individual preferences</strong>.
      </InsightBox>
      <p style={{ color: COLORS.textSecondary, lineHeight: '1.6', marginTop: '20px' }}>
        In the next tutorial, we'll discover what that "something" is â€” and why it changes everything.
      </p>
      <a href="Tutorial-B-TheMachine.html" style={{
        marginTop: '24px',
        padding: '16px 20px',
        background: COLORS.primary,
        borderRadius: '10px',
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
        textDecoration: 'none',
        color: 'white',
      }}>
        <span style={{ fontWeight: '500' }}>
          Next: Tutorial B â€” The Machine
        </span>
        <LucideIcon name="ArrowRight" size={20} />
      </a>
    </>,
  ];
  
  return content[step] || null;
};

// ============================================================================
// MAIN TUTORIAL COMPONENT
// ============================================================================

const Tutorial02A = () => {
  // Navigation state
  const [currentPartIndex, setCurrentPartIndex] = useState(0);
  const [currentStep, setCurrentStep] = useState(0);
  const [soundEnabled, setSoundEnabled] = useState(true);
  
  // Modal state
  const [showGlossary, setShowGlossary] = useState(false);
  const [activeRabbitHole, setActiveRabbitHole] = useState(null);
  
  // Tracking state
  const [exploredRabbitHoles, setExploredRabbitHoles] = useState([]);
  
  // Answer state
  const [answers, setAnswers] = useState({});
  
  // Dev mode
  const [devMode, setDevMode] = useState(false);
  const [headerClickCount, setHeaderClickCount] = useState(0);
  const [lastClickTime, setLastClickTime] = useState(0);
  
  // Handlers
  const handleAnswer = useCallback((key, value) => {
    setAnswers(prev => ({ ...prev, [key]: value }));
  }, []);
  
  const handleRabbitHole = useCallback((id) => {
    setActiveRabbitHole(RABBIT_HOLES[id]);
    if (!exploredRabbitHoles.includes(id)) {
      setExploredRabbitHoles(prev => [...prev, id]);
    }
  }, [exploredRabbitHoles]);
  
  const handleContinue = useCallback(() => {
    const currentPart = PARTS[currentPartIndex];
    if (currentStep < currentPart.steps - 1) {
      setCurrentStep(prev => prev + 1);
    } else if (currentPartIndex < PARTS.length - 1) {
      setCurrentPartIndex(prev => prev + 1);
      setCurrentStep(0);
    }
  }, [currentPartIndex, currentStep]);
  
  const handleBack = useCallback(() => {
    if (currentStep > 0) {
      setCurrentStep(prev => prev - 1);
    } else if (currentPartIndex > 0) {
      const prevPartIndex = currentPartIndex - 1;
      setCurrentPartIndex(prevPartIndex);
      setCurrentStep(PARTS[prevPartIndex].steps - 1);
    }
  }, [currentPartIndex, currentStep]);
  
  const handleRestart = useCallback(() => {
    if (window.confirm('Restart this tutorial? Your progress will be lost.')) {
      setCurrentPartIndex(0);
      setCurrentStep(0);
      setAnswers({});
      setExploredRabbitHoles([]);
    }
  }, []);
  
  const handleHeaderClick = useCallback(() => {
    const now = Date.now();
    if (now - lastClickTime < 500) {
      const newCount = headerClickCount + 1;
      setHeaderClickCount(newCount);
      if (newCount >= 3) {
        setDevMode(prev => !prev);
        setHeaderClickCount(0);
      }
    } else {
      setHeaderClickCount(1);
    }
    setLastClickTime(now);
  }, [headerClickCount, lastClickTime]);
  
  const handleJumpToPart = useCallback((partIndex) => {
    setCurrentPartIndex(partIndex);
    setCurrentStep(0);
  }, []);
  
  // Determine if continue is allowed
  const canContinue = useCallback(() => {
    const partId = PARTS[currentPartIndex].id;
    
    // Part 2, Step 1: Need to submit shape answer
    if (partId === 'whatKindOfMath' && currentStep === 1) {
      return answers.shapeSubmitted === true;
    }
    
    // Part 3, Step 2: Need to pick a preference
    if (partId === 'thePuzzle' && currentStep === 2) {
      return answers.preference !== undefined;
    }
    
    // Part 4, Step 0: Need to submit who's right answer
    if (partId === 'canWeDefineValue' && currentStep === 0) {
      return answers.whoRightSubmitted === true;
    }
    
    return true;
  }, [currentPartIndex, currentStep, answers]);
  
  // Render current content
  const renderContent = () => {
    const partId = PARTS[currentPartIndex].id;
    
    switch (partId) {
      case 'welcome':
        return <WelcomePart step={currentStep} />;
      case 'whatKindOfMath':
        return (
          <WhatKindOfMathPart
            step={currentStep}
            onAnswer={handleAnswer}
            answers={answers}
            soundEnabled={soundEnabled}
            onRabbitHole={handleRabbitHole}
            exploredRabbitHoles={exploredRabbitHoles}
          />
        );
      case 'thePuzzle':
        return (
          <ThePuzzlePart
            step={currentStep}
            onAnswer={handleAnswer}
            answers={answers}
            soundEnabled={soundEnabled}
          />
        );
      case 'canWeDefineValue':
        return (
          <CanWeDefineValuePart
            step={currentStep}
            onAnswer={handleAnswer}
            answers={answers}
            soundEnabled={soundEnabled}
          />
        );
      default:
        return null;
    }
  };
  
  const currentPart = PARTS[currentPartIndex];
  const isLastStep = currentPartIndex === PARTS.length - 1 && currentStep === currentPart.steps - 1;
  
  return (
    <div style={{
      minHeight: '100vh',
      background: COLORS.background,
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
    }}>
      <Header
        currentPartIndex={currentPartIndex}
        currentStep={currentStep}
        exploredRabbitHoles={exploredRabbitHoles}
        onGlossaryClick={() => setShowGlossary(true)}
        onRestartClick={handleRestart}
        onHeaderClick={handleHeaderClick}
        soundEnabled={soundEnabled}
        onSoundToggle={() => setSoundEnabled(prev => !prev)}
      />
      
      <main style={{
        maxWidth: '800px',
        margin: '0 auto',
        padding: '32px 24px',
      }}>
        <div style={{
          background: 'white',
          borderRadius: '16px',
          padding: '32px',
          boxShadow: '0 2px 8px rgba(0,0,0,0.06)',
        }}>
          {renderContent()}
          
          <NavButtons
            onBack={handleBack}
            onContinue={handleContinue}
            canGoBack={currentPartIndex > 0 || currentStep > 0}
            canContinue={canContinue()}
            continueLabel={isLastStep ? 'Complete Tutorial' : 'Continue'}
            soundEnabled={soundEnabled}
          />
        </div>
      </main>

      {/* Tutorial Navigation Footer */}
      <div style={{
        background: '#00356b',
        padding: '24px',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        gap: '16px',
        marginTop: '40px',
      }}>
        <a href="index.html" style={{
          padding: '12px 24px',
          background: '#b8860b',
          borderRadius: '8px',
          color: 'white',
          textDecoration: 'none',
          textAlign: 'center',
          minWidth: '140px',
          fontWeight: '500',
        }}>
          Hub
        </a>
        <a href="Tutorial-B-TheMachine.html" style={{
          padding: '12px 24px',
          background: 'rgba(255,255,255,0.15)',
          borderRadius: '8px',
          color: 'white',
          textDecoration: 'none',
          textAlign: 'center',
          minWidth: '140px',
        }}>
          <div style={{ fontSize: '14px', fontWeight: '500' }}>Next &rarr;</div>
          <div style={{ fontSize: '12px', opacity: 0.8, marginTop: '4px' }}>The Machine</div>
        </a>
      </div>

      {/* Modals */}
      {showGlossary && <GlossaryModal onClose={() => setShowGlossary(false)} />}
      {activeRabbitHole && (
        <RabbitHoleModal
          rabbitHole={activeRabbitHole}
          onClose={() => setActiveRabbitHole(null)}
        />
      )}
      {devMode && (
        <DevModePanel
          onJumpToPart={handleJumpToPart}
          currentPartIndex={currentPartIndex}
          onClose={() => setDevMode(false)}
        />
      )}
    </div>
  );
};



const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<Tutorial02A />);
    </script>
</body>
</html>
